{% extends "layout/base.html" %}

{% block title %}Xác nhận đặt lịch - Spa Beauty{% endblock %}

{% block content %}
<div class="row justify-content-center">
    <div class="col-md-8">

        {% include 'booking/components/progress_bar.html' %}

        <div class="card shadow-sm">
            <div class="card-header bg-success text-white">
                <h4 class="mb-0">
                    <i class="fas fa-check-circle me-2"></i>Xác nhận đặt lịch
                </h4>
            </div>

            <div class="card-body">
                <p class="text-muted mb-4">
                    Vui lòng kiểm tra lại thông tin trước khi xác nhận
                </p>

                <form method="POST">
                    {{ form.hidden_tag() }}

                    <!-- ================= CUSTOMER ================= -->
                    <h5 class="border-bottom pb-2 mb-3">
                        <i class="fas fa-user me-2"></i>Thông tin khách hàng
                    </h5>

                    {% if current_user.is_authenticated %}
                        <p><strong>Họ tên:</strong> {{ current_user.name }}</p>
                        <p><strong>SĐT:</strong> {{ current_user.phone_number }}</p>
                        <p><strong>Địa chỉ:</strong> {{ current_user.address or "Không có" }}</p>
                    {% else %}
                        <p class="text-warning">Khách đặt lịch chưa đăng nhập</p>
                    {% endif %}

                    <!-- ================= SERVICES ================= -->
                    <h5 class="border-bottom pb-2 mt-4 mb-3">
                        <i class="fas fa-spa me-2"></i>Dịch vụ đã chọn
                    </h5>

                    <table class="table table-bordered align-middle">
                        <thead class="table-light">
                            <tr>
                                <th>Dịch vụ</th>
                                <th class="text-end">Thời gian</th>
                                <th class="text-end">Giá</th>
                            </tr>
                        </thead>
                        <tbody>
                            {% for service in services %}
                            <tr>
                                <td>{{ service.name }}</td>
                                <td class="text-end">{{ service.duration }} phút</td>
                                <td class="text-end">{{ service.price | format_currency }}đ</td>
                            </tr>
                            {% endfor %}
                        </tbody>
                    </table>

                    <!-- ================= APPOINTMENT ================= -->
                    <h5 class="border-bottom pb-2 mt-4 mb-3">
                        <i class="far fa-calendar-alt me-2"></i>Chi tiết lịch hẹn
                    </h5>

                    <p>
                        <strong>Ngày:</strong>
                        {{ appointment_date.strftime('%d/%m/%Y') }}
                    </p>

                    <p>
                        <strong>Giờ:</strong>
                        {{ appointment_time.strftime('%H:%M') }}
                    </p>

                    <p>
                        <strong>Nhân viên:</strong>
                        {{ employee.user.name if employee else "Spa sẽ chọn nhân viên phù hợp" }}
                    </p>

                    <p>
                        <strong>Tổng thời gian:</strong>
                        {{ total_duration }} phút
                    </p>

                    <!-- ================= NOTES ================= -->
                    <h5 class="border-bottom pb-2 mt-4 mb-3">
                        <i class="fas fa-sticky-note me-2"></i>Ghi chú
                    </h5>

                    {{ form.notes(class="form-control", rows=3, placeholder="Nhập ghi chú nếu có...") }}

                    <!-- ================= TOTAL ================= -->
                    <div class="alert alert-info mt-4">
                        <strong>Tổng thanh toán:</strong>
                        {{ total_price | format_currency }}đ
                    </div>

                    <div class="d-flex justify-content-between mt-4">
                        <a href="{{ url_for('main_bp.booking_step4') }}" class="btn btn-secondary">
                            ← Quay lại
                        </a>
                        {{ form.submit(class="btn btn-success btn-lg") }}
                    </div>
                </form>
            </div>
        </div>
    </div>
</div>
{% endblock %}
